## UI 模板库插件重构：

### 重构目的、解决的问题:

1、旧的模板库插件部分实现与最初的设计方案不符；  
2、解决旧的模板库插件各种报错问题，包括目录嵌套报错及其他报错；  
3、增加过滤、删除 plist 中冗余资源功能；  
4、内置关键字替换，解除与活动名的关联，解决旧的模板库插件与活动强关联、不够灵活的问题；  
5、增加模板库选择列表，方便将选中模板一键应用到任何目录；  
6、重新整理通用资源链接，添加 activity 链接，方便直接在模板库工程中挑选、生成所需模板；

## 使用说明：

### 一、创建模板：

![image1](/assets/e9ef3225d18d3d30a0215fbd2f5bc144.png)

#### ![image2](/assets/811a66bd687cbc65f6dea66725c5b33c.png)

![image3](/assets/b12b19ec7d5b579a1afccaa6d83221e9.png)

#### 命名规范：

\[一级分类\]\_\[二级分类\]\_\[三级分类\]\_\[tpl\]\_\[版本\]  
一级分类:  slot | casino | common 等,活动如无必要可省略一级分类 activity  
二级分类：功能性命名，tips ｜title｜rank 等  
三....级分类：额外子类型命名，spinning ｜bet\_lock 等  
\_tpl: 自动追加字符，避免与目标目录的原始文件重名  
eg：  
activity\_rank\_tpl\_v1  
activity\_main\_title\_tpl\_v1  
slot\_tips\_spinning\_tpl\_v1  
slot\_tips\_bet\_lock\_tpl\_v1

#### 重点：

生成模板以 CCB 为单位，递归处理其嵌套 CCB，  
如果一个功能模块包含多个 CCB，可将关联 CCB 拖入到主 CCB，实现一键生成；  
eg：排行榜和排行榜列表 item  
![image4](/assets/b47d55c395bc367cd6017d6949a6ae3d.png)

#### 注意：

1、如果输入的 目标名和替换关键字名有重合，将会忽略重复的关键字替换；  
2、如果目标 CCB 为通用（common、slot、casino）资源目录中的 CCB，将会忽略关键字替换，指拷贝 CCB 到模板库，以避免通用资源引用分叉冗余；  
3、默认关闭了裁剪，如果遇到图集过大无法打包会尝试开启裁剪重新打包；  
![image5](/assets/b5bf625d1365aaf4692a03eb687d5a96.png)  
因为只存在删减的情况，不大可能出现裁剪后仍无法打包的情况，但不排除美术通过手动打包的资源原本就超过 2048\*2048 的情况；遇到该情况，请手动拆解图集后打包，并修正模板库中的引用；

### 二、批量创建模板：

#### 适用场景：

- 需要同时处理多个包含相同关键字的 CCB 文件
- 批量生成同一系列的 UI 模板
- 提高模板创建效率，避免重复操作

#### 使用步骤：

**1. 右键文件夹**

在 CocosBuilder 中右键包含 CCB 文件的文件夹，选择"批量生成到模板库"

**2. 输入查找关键字**

```
输入要查找的关键字(用于筛选 .ccb 文件): magic_sort
```

输入关键字后，脚本会递归扫描该文件夹及子文件夹，查找所有文件名包含该关键字的 `.ccb` 文件。

**3. 确认文件列表**

```
找到以下 .ccb 文件:
  1. magic_sort_main.ccb
  2. magic_sort_item.ccb
  3. magic_sort_title.ccb

是否继续处理这些文件? (y/n):
```

脚本会显示找到的所有 CCB 文件，确认后输入 `y` 继续。

**4. 输入原始关键字**

```
输入原始关键字(按情况可输入多个以,分割): magic_sort
```

用于文件名和文件内容的替换，可输入多个关键字，用逗号分隔。

**5. 输入目标名**

```
输入目标名([一级分类]_[二级分类]_[三...级分类]_v1):
一级分类: slot | casino | common 等,活动如无必要可省略一级分类 activity
二级分类: 功能性命名，tips | title | rank 等
三....级分类: 额外子类型命名，spinning | bet_lock 等

示例: activity_magic_v1
```

输入目标名后，脚本会自动转换为模板名（添加 `_tpl`）。

**6. 自动批量处理**

```
======== 开始批量处理 ========

[1/3] 处理文件: magic_sort_main.ccb
拷贝 CCB:/path/to/activity_magic_tpl_v1/activity_magic_tpl_v1_main.ccb
...

[2/3] 处理文件: magic_sort_item.ccb
...

[3/3] 处理文件: magic_sort_title.ccb
...

======== 处理 plist 重复文件 ========
...

======== 批量创建完成 ========
共处理 3 个 .ccb 文件
目标路径: /path/to/ui_module_lib/Resources/activity_magic_tpl_v1
```

#### 与单文件创建的区别：

| 对比项 | 单文件创建 | 批量创建 |
|--------|-----------|---------|
| **触发方式** | 右键 .ccb 文件 | 右键文件夹 |
| **处理数量** | 单个文件 | 多个文件 |
| **文件筛选** | 无 | 关键字筛选 |
| **适用场景** | 独立模块 | 系列模块 |
| **操作步骤** | 较少 | 增加筛选确认 |

#### 命名规范：

与单文件创建相同，格式为：

```
[一级分类]_[二级分类]_[三级分类]_v1
```

间隔符使用**下划线 `_`**

示例：
- `activity_jackpot_v1` → `activity_jackpot_tpl_v1`
- `slot_tips_spinning_v1` → `slot_tips_spinning_tpl_v1`
- `casino_rank_v1` → `casino_rank_tpl_v1`

#### 注意事项：

1. **关键字筛选**：只筛选文件名包含关键字的 CCB，不会筛选文件内容
2. **递归搜索**：会搜索文件夹及所有子文件夹
3. **空关键字**：查找关键字不能为空，必须输入有效值
4. **路径自动推断**：脚本会自动识别 Resources 路径，无需手动配置
5. **批量替换**：所有找到的文件都会使用相同的替换规则和目标名
6. **进度显示**：处理过程会显示当前进度 `[1/3]`, `[2/3]` 等

#### 使用建议：

- 建议先在测试目录验证关键字筛选结果
- 确认文件列表无误后再继续处理
- 批量处理多个文件时，建议使用统一的命名规范
- 如果文件较多（>10个），考虑分批处理

### 三、应用模板到任意目录：

![image6](/assets/1e81deaf27399bf05fbdc2bf7aa25f44.png)
![image7](/assets/ef16b6dd61652e5538e6d4a5e8ca27ce.png)
1、自动列举了模板库中所有已存在的模板，输入对应序号，回车；
2、1-2 秒内执行完毕，看到应用完"成字"样后，到 cocosbuilder 中刷新目录；

\[注意\]：生成出来的文件默认追加了目标目录的相对路径，以避免与原始资源重名；













