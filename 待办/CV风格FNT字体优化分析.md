# CV é£æ ¼ FNT å­—ä½“ä¼˜åŒ–åˆ†ææŠ¥å‘Š

## æ•´ä½“ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **.fnt æ–‡ä»¶æ€»æ•°** | **4,060 ä¸ª** |
| **å”¯ä¸€å­—ä½“åç§°** | 2,261 ä¸ª |
| **.fnt å…ƒæ•°æ®å¤§å°** | 33 MB |
| **å­—ä½“çº¹ç†æ€»å¤§å°** | **186 MB** |

---

## ç›®å½•åˆ†å¸ƒ

| ç›®å½• | æ–‡ä»¶æ•° | å æ¯” |
|------|--------|------|
| **activity/** | 1,923 | 47.4% |
| **casino/** | 256 | 6.3% |
| **dynamic/** | 238 | 5.9% |
| **common/** | 146 | 3.6% |
| **slot/** | 135 | 3.3% |
| **card_system_lagload/** | 55 | 1.4% |
| **å…¶ä»–ï¼ˆå…³å¡ç­‰ï¼‰** | ~1,307 | 32.2% |

---

## é‡å¤æœ€å¤šçš„å­—ä½“æ–‡ä»¶ TOP15

| å­—ä½“æ–‡ä»¶å | é‡å¤æ¬¡æ•° | ç”¨é€” |
|-----------|---------|------|
| `140_3.fnt` | 81 | ç¼–å·å­—ä½“ |
| `jackpot_fever_48_green.fnt` | 55 | å½©ç¥¨æ´»åŠ¨ |
| `jackpot_fever_48_blue.fnt` | 46 | å½©ç¥¨æ´»åŠ¨ |
| `jackpot_fever_48.fnt` | 43 | å½©ç¥¨æ´»åŠ¨ |
| `jackpot_fever_discount_60.fnt` | 33 | æŠ˜æ‰£å±•ç¤º |
| `hr_wheel_white_34.fnt` | 31 | é«˜é¢æ¸¸æˆ |
| `bingo_fever_tip_white_48.fnt` | 22 | Bingo æç¤º |
| `journey_info3_w_24.fnt` | 19 | Journey æ´»åŠ¨ |
| `store_coin_yellow_60.fnt` | 18 | å•†åº—é‡‘å¸ |
| `new_spinui_win_44.fnt` | 18 | æ—‹è½¬ UI |
| `new_spinui_win_32.fnt` | 18 | æ—‹è½¬ UI |
| `store_coin_yellow_120.fnt` | 17 | å•†åº—é‡‘å¸ |
| `road_mission_info_28.fnt` | 17 | Road æ´»åŠ¨ |
| `title_107_2.fnt` | 15 | æ ‡é¢˜å­—ä½“ |
| `activity_center_white_24.fnt` | 15 | æ´»åŠ¨ä¸­å¿ƒ |

---

## æ´»åŠ¨ç›®å½•å­—ä½“åˆ†å¸ƒ TOP15

| æ´»åŠ¨å | å­—ä½“æ•° |
|--------|--------|
| `bingo_island` | 42 |
| `vegas_pass_treasure` | 33 |
| `magical_journey_lb` | 33 |
| `snake_ladders_2025` | 30 |
| `magical_journey_id4` | 29 |
| `magical_journey_hw` | 29 |
| `system_casino_challenge` | 28 |
| `vegas_quest_first_quest` | 27 |
| `santa_s_retreat` | 25 |
| `paddy_s_wonderland_2025` | 25 |
| `club_bingo` | 25 |
| `casino_challenge` | 25 |
| `9th_brithday_fiesta` | 25 |
| `10th_birthday_fiesta` | 25 |
| `club_pinata_game` | 24 |

---

## æ–‡ä»¶å¤§å°åˆ†å¸ƒ

| å¤§å°èŒƒå›´ | æ•°é‡ | å æ¯” |
|---------|------|------|
| 2-5 KB | 2,522 | 62.1% |
| 5-10 KB | 239 | 5.9% |
| > 10 KB | 1,299 | 32.0% |

---

## æœ€å¤§çº¹ç†æ–‡ä»¶ TOP10

| æ–‡ä»¶ | å¤§å° | ä½ç½® |
|------|------|------|
| `mysterious_gift_wild_font_anim.png` | 1.2 MB | å…³å¡ç‰¹æ•ˆ |
| `reward_video_150.png` | 916 KB | common/fonts |
| `168_tanban_num1.png` | 908 KB | å…³å¡å­—ä½“ |
| `brilliant_diamonds_symbol_bonus_spins_font_3d.png` | 740 KB | å…³å¡ç‰¹æ•ˆ |
| `haunted_treats_symbol_wild_10x_trigger_3d_font.png` | 652 KB | å…³å¡ç‰¹æ•ˆ |
| `glitzy_hits_symbols_jackpot_font_3d_sweep.png` | 612 KB | å…³å¡ç‰¹æ•ˆ |
| `1_8.png` | 580 KB | jackpot_clover |
| `brilliant_diamonds_symbol_500x_font_jackpot_win_3d.png` | 548 KB | å…³å¡ç‰¹æ•ˆ |
| `haunted_treats_symbol_batch_bonus_font_3d.png` | 536 KB | å…³å¡ç‰¹æ•ˆ |
| `brilliant_diamonds_symbol_bonus_free_font_3d.png` | 516 KB | å…³å¡ç‰¹æ•ˆ |

---

## common/fonts å…¬å…±å­—ä½“ï¼ˆ75 ä¸ªï¼‰

å¸¸ç”¨å­—ä½“ç¤ºä¾‹ï¼š

| å­—ä½“æ–‡ä»¶ | å¤§å° | ç”¨é€” |
|---------|------|------|
| `button_white_30.fnt` | 15.6 KB | æŒ‰é’®æ–‡å­— |
| `dialog_title_40.fnt` | 12 KB | å¯¹è¯æ¡†æ ‡é¢˜ |
| `gold_font_30pt.fnt` | 12 KB | é‡‘è‰²æ•°å­— |
| `gold_neuron_90.fnt` | 19.7 KB | é‡‘è‰²æ ‡é¢˜ |
| `white_one.fnt` | - | ç™½è‰²é€šç”¨ |
| `bigwin_160.fnt` | 2.8 KB | å¤§èµ¢å±•ç¤º |

---

## å…³é”®å‘ç°

1. **æ´»åŠ¨ç›®å½•å æ¯”è¿‘åŠ** - 1,923 ä¸ªå­—ä½“åœ¨ activity/ ç›®å½•ï¼Œå  47.4%
2. **é‡å¤ä¸¥é‡** - åŒä¸€å­—ä½“æ–‡ä»¶ï¼ˆå¦‚ `140_3.fnt`ï¼‰åœ¨ 81 ä¸ªä¸åŒä½ç½®å­˜åœ¨å‰¯æœ¬
3. **å¤§çº¹ç†é›†ä¸­åœ¨å…³å¡** - è¶…è¿‡ 500KB çš„çº¹ç†ä¸»è¦ç”¨äºå…³å¡ 3D ç‰¹æ•ˆå­—ä½“
4. **å¤§æ–‡ä»¶å æ¯”é«˜** - 32% çš„ fnt æ–‡ä»¶è¶…è¿‡ 10KB

---

## å¼•æ“ç°æœ‰ä¼˜åŒ–æœºåˆ¶

### 1. å­—ä½“é…ç½®ç¼“å­˜ï¼ˆFNTConfigï¼‰

**ä½ç½®**: `frameworks/cocos2d-html5/cocos2d/labels/CCLabelBMFont.js`

| æœºåˆ¶ | è¯´æ˜ |
|------|------|
| **è§£æå™¨** | `cc._fntLoader` è´Ÿè´£è§£æ .fnt æ–‡ä»¶ |
| **ç¼“å­˜ä½ç½®** | `cc.loader.cache[fntFile]` å…¨å±€ç¼“å­˜ |
| **ç¼“å­˜å†…å®¹** | commonHeightã€atlasNameã€fontDefDictionaryã€kerningDict |

```javascript
// åˆå§‹åŒ–æ—¶ä»ç¼“å­˜è·å–
var newConf = cc.loader.getRes(fntFile);
if (!newConf) {
    var txt = cc.loader._loadTxtSync(fntFile);
    newConf = cc._fntLoader.parseFnt(txt, fntFile);
    cc.loader.cache[fntFile] = newConf;  // ç¼“å­˜é…ç½®
}
```

### 2. çº¹ç†ç¼“å­˜æœºåˆ¶

**ä½ç½®**: `frameworks/cocos2d-html5/cocos2d/core/textures/CCTextureCache.js`

| æœºåˆ¶ | è¯´æ˜ |
|------|------|
| **å…¨å±€å•ä¾‹** | `cc.textureCache` |
| **ç¼“å­˜ç»“æ„** | `_textures` å¯¹è±¡ï¼ˆkey = è·¯å¾„ï¼Œvalue = Texture2Dï¼‰ |
| **è‡ªåŠ¨å…³è”** | å­—ä½“çº¹ç†é€šè¿‡ `cc.textureCache.addImage()` è‡ªåŠ¨åŠ è½½ |

```javascript
// å­—ä½“åˆå§‹åŒ–æ—¶åŠ è½½çº¹ç†
texture = cc.textureCache.addImage(newConf.atlasName);
```

### 3. Sprite å¤ç”¨æœºåˆ¶

| æœºåˆ¶ | è¯´æ˜ |
|------|------|
| **å¤ç”¨ç­–ç•¥** | ä½¿ç”¨ `tag`ï¼ˆå­—ç¬¦ç´¢å¼•ï¼‰ç®¡ç† Sprite |
| **æ›´æ–°é€»è¾‘** | å¤ç”¨å·²å­˜åœ¨çš„ Spriteï¼Œä»…æ›´æ–°çº¹ç†åŒºåŸŸ |

```javascript
var fontChar = self.getChildByTag(i);  // å°è¯•è·å–å·²å­˜åœ¨çš„ Sprite
if (!fontChar) {
    fontChar = new cc.Sprite();  // ä¸å­˜åœ¨æ‰åˆ›å»º
    this.addChild(fontChar, 0, i);
} else {
    cmd._updateCharTexture(fontChar, rect, key);  // å¤ç”¨
}
```

---

## å­—ä½“åŠ è½½æµç¨‹

```text
é˜¶æ®µ 1: .fnt æ–‡ä»¶åŠ è½½ä¸è§£æ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ new cc.LabelBMFont(str, fntFile)                            â”‚
â”‚     â†“                                                       â”‚
â”‚ cc.loader.getRes(fntFile)  â† æ£€æŸ¥ç¼“å­˜                        â”‚
â”‚     â†“ [æœªç¼“å­˜]                                               â”‚
â”‚ cc._fntLoader.load(fntFile)  â† å¼‚æ­¥åŠ è½½                      â”‚
â”‚     â†“                                                       â”‚
â”‚ cc._fntLoader.parseFnt(txt)  â† è§£æ .fnt æ ¼å¼                â”‚
â”‚     â†“                                                       â”‚
â”‚ cc.loader.cache[fntFile] = config  â† ç¼“å­˜é…ç½®å¯¹è±¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ 2: çº¹ç†å›¾é›†åŠ è½½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cc.textureCache.addImage(config.atlasName)                  â”‚
â”‚     â†“                                                       â”‚
â”‚ æ£€æŸ¥ _textures[atlasName]                                   â”‚
â”‚     â†“ [æœªç¼“å­˜]                                               â”‚
â”‚ cc.loader.loadImg(atlasName)  â† åŠ è½½ PNG                     â”‚
â”‚     â†“                                                       â”‚
â”‚ new cc.Texture2D() + initWithElement()                      â”‚
â”‚     â†“                                                       â”‚
â”‚ _textures[atlasName] = texture  â† ç¼“å­˜çº¹ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ 3: å­—ç¬¦ Sprite åˆ›å»º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ createFontChars()                                           â”‚
â”‚     â†“                                                       â”‚
â”‚ éå†å­—ç¬¦ä¸²æ¯ä¸ªå­—ç¬¦                                            â”‚
â”‚     â†“                                                       â”‚
â”‚ ä» fontDefDictionary è·å–å­—ç¬¦çŸ©å½¢åŒºåŸŸ                         â”‚
â”‚     â†“                                                       â”‚
â”‚ new cc.Sprite() + initWithTexture(texture, rect)  â† å…±äº«çº¹ç† â”‚
â”‚     â†“                                                       â”‚
â”‚ addChild(sprite, 0, charIndex)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼š
1. **.fnt é…ç½®åªè§£æä¸€æ¬¡**ï¼Œå­˜å‚¨åœ¨ `cc.loader.cache`
2. **çº¹ç†å…¨å±€å…±äº«**ï¼Œæ‰€æœ‰ä½¿ç”¨ç›¸åŒå­—ä½“çš„ Label å…±äº«åŒä¸€çº¹ç†å¯¹è±¡
3. **å»¶è¿ŸåŠ è½½**ï¼Œçº¹ç†å¼‚æ­¥åŠ è½½ï¼ŒLabel ç›‘å¬ `"load"` äº‹ä»¶åå†åˆ›å»ºå­—ç¬¦

---

## å­—ä½“é‡Šæ”¾æœºåˆ¶

### å¼•æ“æä¾›çš„é‡Šæ”¾æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `cc.textureCache.removeTexture(texture)` | ç§»é™¤å•ä¸ªçº¹ç† |
| `cc.textureCache.removeTextureForKey(key)` | æŒ‰è·¯å¾„ç§»é™¤çº¹ç† |
| `cc.textureCache.removeAllTextures()` | æ¸…ç©ºæ‰€æœ‰çº¹ç† |
| `texture.releaseTexture()` | é‡Šæ”¾çº¹ç†ï¼ˆè°ƒç”¨ WebGL deleteTextureï¼‰ |

### è‡ªåŠ¨é‡Šæ”¾æ—¶æœº

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| **é…ç½®ç¼“å­˜** | `cc.loader.cache[fntFile]` **æ°¸ä¸è‡ªåŠ¨é‡Šæ”¾** |
| **çº¹ç†ç¼“å­˜** | `cc.textureCache._textures` **æ°¸ä¸è‡ªåŠ¨é‡Šæ”¾** |
| **Label é”€æ¯** | `removeFromParent()` ä»…æ¸…ç†å­èŠ‚ç‚¹ Spriteï¼Œ**ä¸é‡Šæ”¾çº¹ç†** |

### é¡¹ç›®èµ„æºç®¡ç†ç°çŠ¶

| ç»´åº¦ | ç°çŠ¶ | é£é™© |
|------|------|------|
| **æ´»åŠ¨èµ„æºæ¸…ç†** | æ— ç»Ÿä¸€æœºåˆ¶ | ğŸ”´ é«˜ |
| **å­—ä½“å¼•ç”¨è®¡æ•°** | æ—  | ğŸ”´ é«˜ |
| **é…ç½®å†…å­˜** | æ°¸ä¹…ç¼“å­˜ | ğŸŸ¡ ä¸­ |
| **çº¹ç†å†…å­˜** | æ°¸ä¹…ç¼“å­˜ | ğŸ”´ é«˜ |

**æ ¸å¿ƒé—®é¢˜**ï¼šå¼•æ“æä¾›äº†çº¹ç†ç¼“å­˜æœºåˆ¶ï¼Œä½†é¡¹ç›®å±‚é¢**ç¼ºå°‘å­—ä½“èµ„æºçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼Œæ´»åŠ¨ç»“æŸåèµ„æºæœªé‡Šæ”¾ã€‚

---

## è¿è¡Œæ—¶æ€§èƒ½å½±å“åˆ†æ

### BMFont å¼•æ“å®ç°åŸç†

`cc.LabelBMFont` ç»§æ‰¿è‡ª `cc.SpriteBatchNode`ï¼Œæ¯ä¸ªå­—ç¬¦ä½œä¸ºç‹¬ç«‹çš„ `cc.Sprite` å­èŠ‚ç‚¹ã€‚

```text
cc.LabelBMFont
  â””â”€ extends cc.SpriteBatchNode
      â””â”€ æ¯ä¸ªå­—ç¬¦ = 1 ä¸ª cc.Sprite å­èŠ‚ç‚¹
```

### æ€§èƒ½å½±å“å› ç´ 

#### 1. Draw Call é—®é¢˜

| åœºæ™¯ | Draw Call æ•°é‡ | è¯´æ˜ |
|------|---------------|------|
| åŒä¸€å­—ä½“çš„å¤šä¸ª Label | **1 æ¬¡** | SpriteBatchNode è‡ªåŠ¨åˆæ‰¹ |
| ä¸åŒå­—ä½“çš„å¤šä¸ª Label | **N æ¬¡** | æ¯ä¸ªå­—ä½“çº¹ç† = 1 æ¬¡ Draw Call |
| åŒå± 10 ç§å­—ä½“ | **10+ æ¬¡** | çº¹ç†åˆ‡æ¢å¯¼è‡´æ‰¹æ¬¡æ‰“æ–­ |

**å…³é”®ç»“è®º**ï¼šå­—ä½“æ–‡ä»¶æ•°é‡å¤š â†’ çº¹ç†ç§ç±»å¤š â†’ Draw Call å¢åŠ 

#### 2. å†…å­˜å ç”¨

| ç±»å‹ | å ç”¨æ–¹å¼ | å½±å“ |
|------|---------|------|
| **çº¹ç†å†…å­˜ (GPU)** | æ¯ä¸ª .fnt å¯¹åº”çš„ .png åŠ è½½åˆ°æ˜¾å­˜ | 186 MB çº¹ç† = 186 MB æ˜¾å­˜ä¸Šé™ |
| **é…ç½®å†…å­˜ (CPU)** | .fnt æ–‡ä»¶è§£æåçš„å­—ç¬¦æ˜ å°„è¡¨ | æ¯ä¸ªå­—ä½“ ~10-50 KB |
| **Sprite å¯¹è±¡** | æ¯ä¸ªå­—ç¬¦åˆ›å»º 1 ä¸ª Sprite | 100 å­—æ–‡æœ¬ = 100 ä¸ªå¯¹è±¡ |

#### 3. å­—ç¬¦ä¸²æ›´æ–°å¼€é”€

```javascript
// setString() ä¼šè§¦å‘ createFontChars()
// æ¯æ¬¡æ›´æ–°æ–‡æœ¬ = é”€æ¯æ—§ Sprite + åˆ›å»ºæ–° Sprite
label.setString("æ–°æ–‡æœ¬");  // è§¦å‘å®Œæ•´é‡å»º
```

**é«˜é¢‘æ›´æ–°åœºæ™¯**ï¼ˆå¦‚è®¡æ—¶å™¨ã€ç§¯åˆ†ï¼‰ä¼šäº§ç”Ÿå¤§é‡ GC å‹åŠ›ã€‚

#### 4. çº¹ç†åˆ‡æ¢ä»£ä»·

```text
æ¸²æŸ“é¡ºåºï¼šLabel A (å­—ä½“1) â†’ Label B (å­—ä½“2) â†’ Label C (å­—ä½“1)
Draw Callï¼š    1              2              3 (æ— æ³•åˆå¹¶å›å­—ä½“1)
```

å³ä½¿ä½¿ç”¨ç›¸åŒå­—ä½“ï¼Œå¦‚æœæ¸²æŸ“é¡ºåºè¢«å…¶ä»–å­—ä½“æ‰“æ–­ï¼Œä¹Ÿæ— æ³•åˆæ‰¹ã€‚

### æ€§èƒ½é—®é¢˜ä¸¥é‡åº¦è¯„ä¼°

| é—®é¢˜ | ä¸¥é‡åº¦ | å½±å“èŒƒå›´ |
|------|--------|---------|
| çº¹ç†ç§ç±»è¿‡å¤šå¯¼è‡´ Draw Call é«˜ | ğŸ”´ é«˜ | å…¨å±€æ¸²æŸ“æ€§èƒ½ |
| å¤§çº¹ç†åŠ è½½å»¶è¿Ÿ | ğŸŸ¡ ä¸­ | é¦–æ¬¡æ˜¾ç¤ºå¡é¡¿ |
| é¢‘ç¹ setString çš„ GC å‹åŠ› | ğŸŸ¡ ä¸­ | åŠ¨æ€æ–‡æœ¬åœºæ™¯ |
| é…ç½®å†…å­˜å¸¸é©» | ğŸŸ¢ ä½ | å†…å­˜å ç”¨ |

---

## ä¼˜åŒ–å»ºè®®

### ä¼˜å…ˆçº§ 1ï¼šèµ„æºå»é‡ï¼ˆé«˜æ”¶ç›Šï¼‰

#### 1.1 é‡å»ºå…¨å±€å…±äº«å­—ä½“åº“

- **ç›®æ ‡**ï¼šæ¶ˆé™¤è·¨æ´»åŠ¨é‡å¤
- **é¢„æœŸæ”¶ç›Š**ï¼šå‡å°‘ 30-40% æ´»åŠ¨å­—ä½“æ–‡ä»¶

#### 1.2 å­—ä½“å°ºå¯¸ç²¾ç®€

**å½“å‰é—®é¢˜**ï¼šå­˜åœ¨è¿‡å¤šå°ºå¯¸å˜ä½“ï¼ˆ24, 28, 30, 32, 34, 40, 44, 48, 50, 60, 80, 100, 120, 150, 160ptï¼‰

**å»ºè®®ä¿ç•™**ï¼š
- å°å·ï¼š30ptï¼ˆæŒ‰é’®ã€æç¤ºï¼‰
- ä¸­å·ï¼š48ptï¼ˆæ­£æ–‡ã€æ ‡ç­¾ï¼‰
- å¤§å·ï¼š80ptï¼ˆæ ‡é¢˜ã€å¥–åŠ±ï¼‰
- ç‰¹å¤§ï¼š120ptï¼ˆå¤§èµ¢å±•ç¤ºï¼‰

**é¢„æœŸæ”¶ç›Š**ï¼šå‡å°‘ 30-40% å­—ä½“å˜ä½“

### ä¼˜å…ˆçº§ 2ï¼šèµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆä¸­ç­‰æ”¶ç›Šï¼‰

#### 2.1 æ´»åŠ¨èµ„æºæ¸…ç†æœºåˆ¶

**ç›®æ ‡**ï¼šæ´»åŠ¨ç»“æŸæ—¶é‡Šæ”¾ä¸“å±å­—ä½“èµ„æº

```javascript
// åœ¨ BaseActivity.prototype.onActivityEnd ä¸­æ·»åŠ 
cleanupActivityFonts: function() {
    var themeName = this.getThemeName();
    var pattern = "activity/" + themeName + "/";
    var textures = cc.textureCache._textures;

    for (var key in textures) {
        if (key.indexOf(pattern) !== -1) {
            cc.textureCache.removeTextureForKey(key);
        }
    }
};
```

#### 2.2 å­—ä½“èµ„æºæ± ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰

**ç›®æ ‡**ï¼šé¿å…è¯¯åˆ ä»åœ¨ä½¿ç”¨çš„å…±äº«å­—ä½“

```javascript
var FontResourcePool = {
    _refCount: {},

    retainFont: function(fntFile) {
        this._refCount[fntFile] = (this._refCount[fntFile] || 0) + 1;
    },

    releaseFont: function(fntFile) {
        if (--this._refCount[fntFile] <= 0) {
            var config = cc.loader.getRes(fntFile);
            if (config && config.atlasName) {
                cc.textureCache.removeTextureForKey(config.atlasName);
            }
            delete cc.loader.cache[fntFile];
        }
    }
};
```

#### 2.3 æ¸…ç†æœªä½¿ç”¨å­—ä½“

- ç”Ÿæˆå®Œæ•´çš„å­—ä½“ä½¿ç”¨æŠ¥å‘Š
- è¯†åˆ«é›¶å¼•ç”¨çš„å­—ä½“æ–‡ä»¶
- æ¸…ç†æœªä½¿ç”¨å­—ä½“

#### 2.4 å¤§çº¹ç†ä¼˜åŒ–

- è¯„ä¼° 1MB+ çš„ç‰¹æ•ˆå­—ä½“æ˜¯å¦å¿…è¦
- è€ƒè™‘ä½¿ç”¨æ›´å°çš„å°ºå¯¸æˆ–å‹ç¼©

### ä¼˜å…ˆçº§ 3ï¼šåˆæ‰¹ä¼˜åŒ–ï¼ˆè¿è¡Œæ—¶æ€§èƒ½ï¼‰

#### 3.1 å­—ä½“çº¹ç†åˆå¹¶ï¼ˆAtlas åˆå¹¶ï¼‰

**ç›®æ ‡**ï¼šå°†å¤šä¸ªå°å­—ä½“çº¹ç†åˆå¹¶ä¸ºå•ä¸€ Atlasï¼Œå‡å°‘çº¹ç†åˆ‡æ¢

```text
åˆå¹¶å‰ï¼š
  white_30.png (64KB) â†’ 1 Draw Call
  white_48.png (80KB) â†’ 1 Draw Call
  gold_30.png  (70KB) â†’ 1 Draw Call
  å…± 3 æ¬¡ Draw Call

åˆå¹¶åï¼š
  common_fonts_atlas.png (200KB) â†’ 1 Draw Call
  å…± 1 æ¬¡ Draw Call
```

**å®æ–½æ­¥éª¤**ï¼š
1. ä½¿ç”¨ TexturePacker åˆå¹¶å¸¸ç”¨å­—ä½“çº¹ç†
2. æ›´æ–° .fnt æ–‡ä»¶ä¸­çš„çº¹ç†åæ ‡æ˜ å°„
3. ä¿®æ”¹å­—ä½“åŠ è½½è·¯å¾„

**é¢„æœŸæ”¶ç›Š**ï¼šå‡å°‘ 50-70% å­—ä½“ç›¸å…³ Draw Call

#### 3.2 æ¸²æŸ“é¡ºåºä¼˜åŒ–

**åŸåˆ™**ï¼šå°†ä½¿ç”¨ç›¸åŒå­—ä½“çš„ Label åœ¨æ¸²æŸ“æ ‘ä¸­ç›¸é‚»æ’åˆ—

```text
ä¼˜åŒ–å‰ï¼š
  Layer
    â”œâ”€ Label A (font_white)
    â”œâ”€ Sprite X
    â”œâ”€ Label B (font_gold)
    â”œâ”€ Sprite Y
    â””â”€ Label C (font_white)  // æ— æ³•ä¸ A åˆæ‰¹

ä¼˜åŒ–åï¼š
  Layer
    â”œâ”€ Label A (font_white)
    â”œâ”€ Label C (font_white)  // å¯ä¸ A åˆæ‰¹
    â”œâ”€ Sprite X
    â”œâ”€ Sprite Y
    â””â”€ Label B (font_gold)
```

#### 3.3 å­—ä½“å¤ç”¨ç­–ç•¥

**ç»Ÿä¸€å¸¸ç”¨å­—ä½“**ï¼š

| ç”¨é€” | æ¨èå­—ä½“ | æ›¿ä»£ |
|------|---------|------|
| ç™½è‰²æ–‡æœ¬ | `white_48.fnt` | æ›¿ä»£ white_30/32/34/40/44 |
| é‡‘è‰²æ•°å­— | `gold_font_48pt.fnt` | æ›¿ä»£ gold_30/40/54/60/64 |
| æŒ‰é’®æ–‡å­— | `button_white_30.fnt` | ç»Ÿä¸€ä½¿ç”¨ |

**æ”¶ç›Š**ï¼šå‡å°‘åŒå±å­—ä½“ç§ç±» â†’ å‡å°‘ Draw Call

#### 3.4 åŠ¨æ€æ–‡æœ¬ä¼˜åŒ–

**é—®é¢˜**ï¼šé¢‘ç¹ `setString()` å¯¼è‡´ Sprite é‡å»º

**æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨ Sprite å¯¹è±¡
- é¿å…æ¯å¸§æ›´æ–°æ–‡æœ¬ï¼Œä½¿ç”¨èŠ‚æµ

---

## é¢„æœŸæ”¶ç›Šæ±‡æ€»

| ç»´åº¦ | å½“å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|------|------|--------|------|
| æ–‡ä»¶æ•°é‡ | 4,060 | ~2,500 | 38% |
| å­˜å‚¨ç©ºé—´ | 219 MB | 140 MB | 36% |
| ä¸‹è½½ä½“ç§¯ | - | - | 20-30% |
| Draw Call | - | - | 50-70% |

---

## å…³é”®æ–‡ä»¶å‚è€ƒ

| ç±»å‹ | æ–‡ä»¶è·¯å¾„ |
|------|----------|
| **å¼•æ“ BMFont å®ç°** | `frameworks/cocos2d-html5/cocos2d/labels/CCLabelBMFont.js` |
| **å¼•æ“çº¹ç†ç¼“å­˜** | `frameworks/cocos2d-html5/cocos2d/core/textures/CCTextureCache.js` |
| **å¼•æ“æ‰¹é‡æ¸²æŸ“** | `frameworks/cocos2d-html5/cocos2d/core/sprites/CCSpriteBatchNode.js` |
| **å­—ä½“åŠ è½½å™¨** | `frameworks/cocos2d-html5/cocos2d/labels/CCLabelBMFont.js` (cc._fntLoader) |
| **é¡¹ç›®èµ„æºç®¡ç†** | `src/common/model/ResourceMan.js` |
| **æ´»åŠ¨åŸºç±»** | `src/task/entity/BaseActivity.js` |
| **å…¬å…±å­—ä½“ç›®å½•** | `res_oldvegas/common/fonts/` |
| **æ´»åŠ¨å­—ä½“ç›®å½•** | `res_oldvegas/activity/*/fonts/` |

---

**ç”Ÿæˆæ—¥æœŸ**: 2025-11-27
**æ•°æ®æ¥æº**: res_oldvegas ç›®å½•åˆ†æ
