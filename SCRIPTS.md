# 📚 文档项目脚本说明

## 🚀 快速开始

```bash
# 首次使用
npm run init    # 初始化环境

# 日常使用
npm run dev     # 启动开发服务器
npm run sync    # 一键同步到远程
```

## 📝 核心命令（仅需这些）

| 命令 | 说明 | 使用场景 |
|------|------|----------|
| `npm run init` | 初始化环境 | 首次使用或修复环境问题 |
| `npm run dev` | 启动开发服务器 | 日常文档编写和预览 |
| `npm run sync` | 一键同步 | 自动构建、提交、推送、监控部署 |
| `npm run build` | 本地构建 | 测试构建是否成功 |
| `npm run status` | 检查状态 | 查看文档仓库状态 |

## 💡 日常工作流

### 1. 首次设置
```bash
npm run init    # 配置环境（安装依赖、配置 Git 等）
npm run dev     # 启动开发服务器
```

### 2. 编写文档
```bash
npm run dev     # 启动开发服务器，访问 http://localhost:5173
# 编写 Markdown 文档，实时预览
# 插入图片无需特殊处理，构建时自动优化
```

### 3. 提交更新
```bash
npm run sync    # 一键完成所有操作
# ✅ 自动处理图片（下载外部图片、统一管理）
# ✅ 自动构建测试
# ✅ 自动生成提交信息
# ✅ 自动推送到远程
# ✅ 自动监控 GitHub Actions 部署
# ✅ 部署完成后发送通知
```

## 🎯 功能特性

### 图片自动处理
- **无需手动管理**：直接在 Markdown 中插入图片
- **支持多种来源**：本地图片、Gitee 图片、其他外部链接
- **自动优化**：
  - 下载外部图片到本地（解决防盗链问题）
  - 统一存储到 `public/assets/` 目录
  - 生成唯一 ID 避免冲突
  - 自动更新 Markdown 中的引用

### 智能同步
- **构建测试**：推送前自动测试构建
- **智能提交**：根据更改内容生成提交信息
- **冲突处理**：自动使用 rebase 保持线性历史
- **部署监控**：推送后自动监控 GitHub Actions
- **结果通知**：部署成功或失败时发送系统通知

### 环境修复
`npm run init` 可以解决：
- Node.js 依赖缺失
- GitHub CLI 未配置
- Git 中文路径问题
- 脚本权限问题

## 📁 项目结构

```
docs/
├── .vitepress/
│   ├── config.mjs          # VitePress 配置
│   └── scripts/            # 自动化脚本
│       ├── build.sh        # 本地构建
│       ├── build-ci.sh     # CI 构建
│       ├── sync.sh         # 同步脚本
│       ├── init.sh         # 初始化脚本
│       └── ...
├── public/
│   └── assets/            # 统一的图片存储
├── 各种文档目录/
└── package.json           # 项目配置
```

## ⚠️ 注意事项

1. **保持简洁**：只使用 npm 命令，避免直接调用脚本
2. **图片处理**：无需手动处理，`sync` 会自动优化
3. **提交前测试**：`sync` 包含构建测试，确保质量
4. **网络问题**：如果部署监控超时，可手动查看 GitHub Actions

## 🆘 常见问题

### 环境问题
```bash
npm run init    # 一键修复大部分环境问题
```

### 构建失败
```bash
npm run build   # 本地测试构建，查看具体错误
```

### 图片显示问题
- 开发模式：图片会自动创建符号链接用于预览
- 生产构建：图片会被处理并更新引用
- 无需手动干预，系统自动处理

## 📞 需要帮助？

- 查看构建日志：`cat /tmp/vitepress-build.log`
- 查看同步日志：`cat /tmp/sync-build.log`
- GitHub Actions：访问仓库的 Actions 页面查看部署详情