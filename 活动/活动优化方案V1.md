# 活动优化方案

## 一、业务逻辑代码

### 1.1 Activity 模块

#### 1.1.1 核心功能
- 按照配置自行注册到 ActivityMan
- 如果与关卡有相关交互，则暴露出自定义接口由 Manager 统一监听

#### 1.1.2 代码加载（✅暂缓）
- 添加代码加载方法
- 根据不同的活动皮肤导入(相同模块，但是表现或者功能可能出现差异)

### 1.2 Widget 模块

#### 1.2.1 部分功能优化组件
- **气泡提示**（✅）（组件化）
- **红点提示**（✅）（组件化）
- **Bet Up、Bet Lock**（封装到基类，并不对外暴露）（✅）

#### 1.2.2 待优化项
- 整理气泡关逻辑
- 新增配置

### 1.3 Entrance 模块

#### 1.3.1 功能点
- 红点提示

---

## 二、自动化及相关工作

### 2.1 优化创建脚本
- 按照活动所需的功能点，创建活动时可选择插入相关代码块

### 2.2 AI 文档建设
- 逐渐完善补充 AI 相关文档，并按照功能或者模块进行区分。

### 2.3 AI 功能迭代
- 创建好完整的流程后，尝试使用 AI 进行功能迭代、优化等
- 逐渐使用 AI 覆盖以下体力工作：（✅skill）
  - 创建活动
  - 移植功能
  - 更新赛季资源
  - 模块化功能开发
  - 初步代码测试
  - 文档自迭代
---

## 三、资源相关

### 美术规范

### 3.1 制作规范要求

##### 3.1.1 资源检查
- 检查多余资源、引用错误等（图片、CCB 等）
- ccb中是否存在占位检查或者查看时显隐的部分

##### 3.1.2 命名规范
- **格式**：`活动名称_功能块_功能`
- 复制的资源如果不符合规范，按照规范重命名
- 符合规范的资源只改活动名称

##### 3.1.3 Label 使用规范
- Label 不要直接添加缩放
- 时间线中也要避免缩放

##### 3.1.4 资源打包规范
- 同功能的 plist 放在一起
- 背景图不要打入 plist

### 3.2 功能模板
- 以通用功能模块为基本单位
- 创建对应功能模板（要跟代码对应）
- 包括但不限于：
  - Rank（排行榜）
  - Pass（通行证）
  - 搭售
  - 地图

### 3.3 程序资源规范

#### 3.3.1 模板创建优化
- 优化模板创建脚本
- 支持功能块创建资源模板

#### 3.3.2 UI 接口开放
- 实现功能时尽量开放 UI 相关接口
- 统一节点命名
- 尽可能支持美术通过 CCB 调节 UI 布局，包括但不限于：
  - 领奖弹板奖励的奖励分布
  - 棋盘类等功能布局
- 形成对应的规范文档交付美术

### 3.4 冗余资源处理
- 过期活动资源归档
- 通用资源
- 合并常用相同资源，并转移到通用资源中
---

## 四、程序 - 前端开发

### 4.1 协议规范
- 固定前后端协议字段
- 同功能保持结构、字段名称相同

### 4.2 代码封装
- 前端封装功能模块
- 统一枚举定义

### 4.3 代码规范

#### 4.3.1 注释规范
- 规范注释格式
- 方便 AI 读取和理解

#### 4.3.2 命名规范
- 统一命名规则
- 提高代码可读性

### 4.4 测试数据模块
- 添加测试数据模块
- 定义通用活动数据
- 可自定义数据结构
- 创建开关控制
- 通过数据结构便可先于后端开发（先有结构即可开始逻辑开发）

### 4.5 文件结构规范

```
controller/
├── game/
│   └── ActivityGameLogic.js           # 消耗类活动玩法相关
├── ui/
│   ├── pass/
│   │   ├── XXPassController.js
│   │   ├── XXPassFreeItemController.js
│   │   ├── XXPassNextAndUnlockController.js
│   │   ├── XXPassNextController.js
│   │   ├── XXPassPaidItemController.js
│   │   ├── XXPassPointItemController.js
│   │   ├── XXPassRewardController.js
│   │   └── XXXPassUIController.js
│   ├── rank/
│   │   ├── XXRankUIController.js
│   │   └── XXRankItemController.js
│   ├── dialog/
│   │   ├── RewardDialogController.js  # 领奖弹板
│   │   ├── InfoDialogController.js    # 信息弹窗
│   │   └── ConfirmDialogController.js # 确认弹窗
│   ├── XXActivityRewardHandlersEnum.js.js
│   ├── title.js
│   └── faq.js
├── model/
│   ├── UIModel.js                    # ui管理，获取不同皮肤的文件地址等
│   └── ActivityDataModel.js          # 活动数据管理
├── service/
│   ├── net.js                        # 网络请求服务
│   ├── test.js                       # 提供数据请求返回接口，模拟服务器返回数据发送
│   └── cache.js                      # 缓存服务
├── config/
│   ├── ActivityConfig.js             # 活动配置
│   ├── EventEnum.js                  # 活动内部时间枚举
│   └── TestDataConfig.js             # 测试数据配置（✅）
├── mainUi.js
├── widget.js
└── entrance.js
```

### 4.6 模块职责说明

#### 4.6.1 Controller 层
- **职责**：处理用户交互、协调 Model 和 View
- **规范**：
  - 不直接操作 DOM，通过 View 层进行
  - 不包含业务逻辑计算，委托给 Model 或 Service
  - 保持单一职责，一个 Controller 只负责一个功能模块

#### 4.6.2 Model 层
- **职责**：数据管理、业务逻辑计算
- **规范**：
  - 提供数据的增删改查接口
  - 包含数据验证逻辑
  - 触发数据变更事件通知

#### 4.6.3 Service 层
- **职责**：提供通用服务（网络、缓存等）
- **规范**：
  - 提供统一的错误处理
  - 支持可配置和可扩展

### 4.7 版本控制规范

#### 4.7.1 提交信息规范
**类型 (type)**：
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建/工具链相关

**app (type)**：
- `CV`: classic vegas
- `DH`: double hit

**示例**：
```
[feat] CV:活动优化验证
```
---

## 五、实施计划与时间表

### 5.1 总体时间规划

| 阶段 | 时间周期 | 主要任务 | 负责团队 | 完成标准 |
|------|----------|----------|----------|----------|
| **阶段一** | 第 1-2 周 | 业务逻辑代码优化 | 前端团队 | 代码重构完成，通过代码审查 |
| **阶段二** | 第 3-4 周 | 自动化工具开发 | 前端+工具团队 | 脚本工具可用，文档完善 |
| **阶段三** | 第 5-6 周 | 资源规范落地 | 美术+程序团队 | 规范文档发布，模板可用 |
| **阶段四** | 第 7-8 周 | 前端架构升级 | 前端团队 | 新架构上线，性能达标 |
| **阶段五** | 第 9-10 周 | 测试与优化 | 全体团队 | 所有功能测试通过 |
| **阶段六** | 第 11-12 周 | 文档完善与培训 | 技术负责人 | 团队成员掌握新流程 |

### 5.2 阶段一：业务逻辑代码优化（第 1-2 周）

#### 第 1 周任务清单
- [ ] **Day 1-2**: Activity 模块重构
  - 实现自动注册机制
  - 设计插件式接口
  - 编写单元测试
- [ ] **Day 3-4**: Widget 模块优化
  - 重构掉落系统
  - 优化红点提示逻辑
  - 封装 Bet 相关功能到基类
- [ ] **Day 5**: 代码审查与调整

#### 第 2 周任务清单
- [ ] **Day 1-2**: Entrance 模块优化
  - 统一红点管理
  - 优化入口加载逻辑
- [ ] **Day 3-4**: 集成测试
  - 编写集成测试用例
  - 修复发现的问题
- [ ] **Day 5**: 文档编写与知识分享

#### 验收标准
- ✅ 代码覆盖率达到 80% 以上
- ✅ 所有单元测试和集成测试通过
- ✅ 代码审查通过，无严重问题
- ✅ 技术文档完成

### 5.3 阶段二：自动化工具开发（第 3-4 周）

#### 第 3 周任务清单
- [ ] **Day 1-2**: 设计脚本架构
  - 定义脚本输入输出格式
  - 设计模块化代码块
  - 创建配置模板
- [ ] **Day 3-4**: 开发创建脚本
  - 实现代码块选择逻辑
  - 开发代码生成引擎
  - 添加错误处理
- [ ] **Day 5**: 脚本测试与优化

#### 第 4 周任务清单
- [ ] **Day 1-3**: AI 文档库建设
  - 整理现有技术文档
  - 编写 AI 训练数据
  - 创建文档索引系统
- [ ] **Day 4-5**: AI 工具集成测试
  - 测试活动创建流程
  - 测试功能移植流程
  - 收集反馈并优化

#### 验收标准
- ✅ 脚本可以成功创建基础活动框架
- ✅ AI 能够理解并执行基本任务
- ✅ 工具使用文档完善
- ✅ 团队成员完成工具培训

### 5.4 阶段三：资源规范落地（第 5-6 周）

#### 第 5 周任务清单
- [ ] **Day 1-2**: 制定美术规范
  - 编写资源命名规范文档
  - 创建检查清单
  - 设计审核流程
- [ ] **Day 3-4**: 开发资源检查工具
  - 实现资源命名检查
  - 实现引用检查
  - 实现 plist 优化建议
- [ ] **Day 5**: 美术团队培训

#### 第 6 周任务清单
- [ ] **Day 1-2**: 创建功能模板
  - Rank 模板
  - Pass 模板
  - 地图模板
- [ ] **Day 3-4**: 模板测试与优化
  - 在实际项目中应用
  - 收集使用反馈
  - 优化模板设计
- [ ] **Day 5**: 文档完善

#### 验收标准
- ✅ 资源规范文档发布
- ✅ 检查工具可用
- ✅ 至少 3 个功能模板完成
- ✅ 美术团队掌握新规范

### 5.5 阶段四：前端架构升级（第 7-8 周）

#### 第 7 周任务清单
- [ ] **Day 1-2**: 协议规范制定
  - 定义标准数据结构
  - 编写协议文档
  - 与后端团队对齐
- [ ] **Day 3-4**: 代码封装
  - 封装功能模块
  - 统一枚举定义
  - 创建工具类库
- [ ] **Day 5**: 代码审查

#### 第 8 周任务清单
- [ ] **Day 1-2**: 测试数据模块开发
  - 实现数据模拟器
  - 创建测试数据集
  - 开发开关控制面板
- [ ] **Day 3-4**: 新架构迁移
  - 迁移现有活动到新架构
  - 性能测试
  - 问题修复
- [ ] **Day 5**: 验收与发布

#### 验收标准
- ✅ 新架构性能提升 30% 以上
- ✅ 代码可维护性显著提升
- ✅ 测试数据模块可用
- ✅ 至少 2 个活动迁移成功

### 5.6 里程碑检查点

#### M1：业务逻辑优化完成（第 2 周末）
- 核心模块重构完成
- 测试覆盖率达标
- 文档完成

#### M2：自动化工具可用（第 4 周末）
- 创建脚本可用
- AI 文档库初步建立
- 工具培训完成

#### M3：资源规范发布（第 6 周末）
- 规范文档发布
- 模板库建立
- 检查工具上线

#### M4：新架构上线（第 8 周末）
- 架构升级完成
- 性能达标
- 迁移路径明确

---

## 六、测试

### 6.1 美术自测
- 使用检测脚本进行初次测试，检查过大、丢失引用等
- 确认有无冗余资源
- 检查结构，确认遮罩大小、位置等
- 是否存在异常缩放

### 6.2 程序自测
- 引入AI对脚本和代码进行初次检查，是否存在书写规范异常、注释异常、冗余代码、遗漏log等
- 导入测试模块数据，初步检测活动运行中是否存在报错、内存泄露等异常
- 预测帧率、dc数量等（待确认）
